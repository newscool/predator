<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./css/bulma.min.css">
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css">
    <link rel="stylesheet" href="./css/all.css">
    <link rel="stylesheet" href="./css/c3.css">
    <title>iVH - Predator</title>
</head>

<body>
    <nav>
        <div class="logo">
            <img src="./img/logo.png" alt="Predator">
        </div>
        <ul class="tab">
            <li>
                <div class="item">
                    <i class="fas fa-car"></i>
                    <span>Pre Process</span>
                </div>
            </li>
            <li>
                <div class="item">
                    <i class="fas fa-cog"></i>
                    <span>Simulation</span>
                </div>
            </li>
            <li class="is-active">
                <div class="item">
                    <i class="fas fa-poll"></i>
                    <span>Post Process</span>
                </div>
            </li>
        </ul>
        <div class="util">
            <a href="" class="button is-danger"><i class="fas fa-power-off"></i>Logout</a>
        </div>
    </nav>

    <section class="section postprocess">
        <div class="container">

            <div class="columns">
                <aside class="column is-4">
                    <div class="box is-fixed">
                        <h2 class="title is-6"><i class="far fa-folder-open"></i>Project: <span name="title"></span></h2>
                        <div class="content">
                            <ul class="projectInfo">
                                <li>
                                    <div class="item-name">Vehicles</div>
                                    <div class="item-value" name="type"></div>
                                </li>
                                <li>
                                    <div class="item-name">Configure Axle</div>
                                    <div class="item-value">Front : <span name="frontAxle"></span> / Rear : <span name="rearAxle"></span></div>
                                </li>
                                <li>
                                    <div class="item-name">Sub-system</div>
                                    <div class="item-value"><span name="subSystem"></span></div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="compare-list box">
                        <h2>Simulation Record</h2>
                        <ul class="compare-items">
                            <li>
                                <div class="info">
                                    <span class="view"><i class="fas fa-check-square"></i></span>
                                    <span class="title">Project_001</span>
                                    <span class="date">2019.11.11</span>
                                </div>
                                <div class="sub-list">
                                    <h4>Parallel Wheel Travel</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>Wheel Travel</span>
                                        </li>
                                        <li>
                                            <span>Wheel Base</span>
                                        </li>
                                        <li>
                                            <span>Wheel Tread</span>
                                        </li>
                                        <li>
                                            <span>Camber</span>
                                        </li>
                                    </ul>
                                    <h4>Longitudinal Wheel Centre Compliance</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>side view angle</span>
                                        </li>
                                        <li>
                                            <span>Toe</span>
                                        </li>
                                    </ul>
                                    <h4>Longitudinal Toe Compliance</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>Vertical Force</span>
                                        </li>
                                        <li>
                                            <span>Lateral Force</span>
                                        </li>
                                    </ul>
                                    <h4>Lateral Wheel Centre Compliance</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>Longitudinal Force</span>
                                        </li>
                                        <li>
                                            <span>Aliging Moment</span>
                                        </li>
                                    </ul>
                                    <h4>Lateral Toe Compliance</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>Overturing Moment</span>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li>
                                <div class="info">
                                    <span class="view"><i class="fas fa-check-square"></i></span>
                                    <span class="title">Project_002</span>
                                    <span class="date">2019.11.12</span>
                                </div>
                                <div class="sub-list">
                                    <h4>Parallel Wheel Travel</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>Wheel Travel</span>
                                        </li>
                                        <li>
                                            <span>Wheel Base</span>
                                        </li>
                                        <li>
                                            <span>Wheel Tread</span>
                                        </li>
                                        <li>
                                            <span>Camber</span>
                                        </li>
                                    </ul>
                                    <h4>Longitudinal Wheel Centre Compliance</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>side view angle</span>
                                        </li>
                                        <li>
                                            <span>Toe</span>
                                        </li>
                                    </ul>
                                    <h4>Longitudinal Toe Compliance</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>Vertical Force</span>
                                        </li>
                                        <li>
                                            <span>Lateral Force</span>
                                        </li>
                                    </ul>
                                    <h4>Lateral Wheel Centre Compliance</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>Longitudinal Force</span>
                                        </li>
                                        <li>
                                            <span>Aliging Moment</span>
                                        </li>
                                    </ul>
                                    <h4>Lateral Toe Compliance</h4>
                                    <ul class="compare-items-2">
                                        <li>
                                            <span>Overturing Moment</span>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>
                </aside>

                <div class="column is-8">
                    <div class="content-tab">
                        <ul>
                            <li class="is-active">Current Simulation</li>
                            <li>Compare Simulation</li>
                        </ul>
                    </div>
                    <div class="box is-result tab-content">
                        <h3>Project Summary</h3>
                        <ul class="userInfo">
                            <li>
                                <span class="name">Identification</span>
                                <span class="value">kildong_machine(Hong Kil Dong)</span>
                            </li>
                            <li>
                                <span class="name">Employee number</span>
                                <span class="value">90174371029</span>
                            </li>
                            <li>
                                <span class="name">Report Date</span>
                                <span class="value today"></span>
                            </li>
                        </ul>

                        <h3>Summary of K&C Result</h3>
                        <table class="table is-fullwidth is-bordered table-result">
                            <thead>
                                <tr>
                                    <th>Load Case</th>
                                    <th>Item</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td rowspan="4">Vertical Parallel</td>
                                    <td>Bump Steer (deg/mm)<br>Negative Value : Toe-Out</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>Bump Camber (deg/m)</td>
                                    <td>-0.035</td>
                                </tr>
                                <tr>
                                    <td>Wheel Center Locus (mm/mm)</td>
                                    <td>-0.040</td>
                                </tr>
                                <tr>
                                    <td>Wheel Rate(N/mm)</td>
                                    <td>25.95</td>
                                </tr>
                                <tr>
                                    <td rowspan="4">Vertical Opposite</td>
                                    <td>Roll Steer Change (deg/deg)Positive Value : Toe-Out</td>
                                    <td>0.019</td>
                                </tr>
                                <tr>
                                    <td>Roll Camber Change (deg/deg)</td>
                                    <td>-0.599</td>
                                </tr>
                                <tr>
                                    <td>Wheel Vertical Loads v Roll Angle(N/deg) (at WC)</td>
                                    <td>-441.1</td>
                                </tr>
                                <tr>
                                    <td>Suspension Roll Rate (Nmm/deg) (at WC)</td>
                                    <td>528.2</td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="table is-fullwidth is-bordered table-result">
                            <thead>
                                <tr>
                                    <th>Load Case</th>
                                    <th>Item</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td rowspan="3">Lateral Opposite</td>
                                    <td>Lateral compliance at WC (mm/KN)</td>
                                    <td>0.822</td>
                                </tr>
                                <tr>
                                    <td>Lateral Steer (deg/KN)Positive Value : Toe-Out</td>
                                    <td>-0.029</td>
                                </tr>
                                <tr>
                                    <td>Lateral Camber (deg/KN)</td>
                                    <td>-0.407</td>
                                </tr>
                                <tr>
                                    <td rowspan="3">Lateral Parallel</td>
                                    <td>Lateral compliance at WC (mm/KN)</td>
                                    <td>0.891</td>
                                </tr>
                                <tr>
                                    <td>Lateral Steer (deg/KN)Positive Value : Toe-Out</td>
                                    <td>-0.036</td>
                                </tr>
                                <tr>
                                    <td>Lateral Camber (deg/KN)</td>
                                    <td>-0.250</td>
                                </tr>
                                <tr>
                                    <td rowspan="2">Toe Compliance</td>
                                    <td>Lateral Steer (deg/Nm)Positive Value : Toe-Out</td>
                                    <td>0.025</td>
                                </tr>
                                <tr>
                                    <td>Lateral Camber (deg/Nm)</td>
                                    <td>-0.008</td>
                                </tr>
                                <tr>
                                    <td rowspan="2">Toe Compliance</td>
                                    <td>Lateral Steer (deg/Nm)Positive Value : Toe-Out</td>
                                    <td>0.025</td>
                                </tr>
                                <tr>
                                    <td>Lateral Camber (deg/Nm)</td>
                                    <td>-2.479</td>
                                </tr>
                                <tr>
                                    <td rowspan="3">Fore-Aft Mode</td>
                                    <td>Longitudinal Compliance (mm/KN)</td>
                                    <td>3.473</td>
                                </tr>
                                <tr>
                                    <td>Longitudinal Steer (deg/KN)Negative Value : Toe-Out)</td>
                                    <td>0.370</td>
                                </tr>
                                <tr>
                                    <td>Longitudinal Caster (deg/KN)</td>
                                    <td>-0.734</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="is-waiting">
                            <span><i class="far fa-clock"></i>Waiting for Result</span>
                        </div>

                        <!-- chart -->
                        <div id="charts"></div>
                    </div>
                    <div class="box is-result tab-content" style="display: none;">
                        <h2 class="title is-4">Compare</h2>
                        <div class="is-waiting">
                            <span><i class="far fa-clock"></i>Waiting for Result</span>
                        </div>
                        <!-- chart -->
                        <div id="charts-compare"></div>
                    </div>

                    <div class="level">
                        <div class="level-left">
                            <div class="level-item">
                                <div class="buttons">
                                    <a href="" class="button is-success"><i class="fas fa-file-pdf"></i>Download PDF</a>
                                    <a href="" class="button button-save is-danger"><i class="fas fa-save"></i>Save Result</a>
                                </div>
                            </div>
                        </div>
                        <div class="level-right">
                            <div class="level-item">
                                <div class="buttons">
                                    <a href="./new_project.html" class="button is-link"><i class="fas fa-home"></i>Go to Pre Process</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            © Institute of Vehicle Engineering
        </div>
    </footer>

    <!-- modal save -->
    <div class="modal modal-save">
        <div class="modal-background"></div>
        <div class="modal-content">
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">Save Result</p>
                    <button class="delete" aria-label="close"></button>
                </header>
                <section class="modal-card-body has-text-centered">
                    Do you want to save <span class="project_title" name="title"></span>?
                </section>
                <footer class="modal-card-foot">
                    <button class="button is-success">Save</button>
                    <button class="button">Cancel</button>
                </footer>
            </div>
        </div>
        <button class="modal-close is-large" aria-label="close"></button>
    </div>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.12.0/d3.min.js"></script>
    <script src="./js/c3.js"></script>
    <script>
        $(function () {

            // 오늘날짜
            var today = new Date();
            var todayDate = today.getFullYear() + "." + (today.getMonth() + 1) + "." + today.getDate();
            $(".today").text(todayDate)


            var chart_compare;
            // content tab
            $(".content-tab li").click(function () {
                var idx = $(this).index();
                $(".content-tab li").removeClass("is-active");
                $(this).addClass("is-active");

                $(".tab-content").hide();
                $(".tab-content").eq(idx).show();

                if (idx == 1) {
                    $(".compare-list").show();

                    chart_compare = c3.generate({
                        bindto: "#charts-compare",
                        data: {
                            columns: [
                                ['Project_001', 1, 2, 3, 4, 5, 6],
                                ['Project_002', 4, 6, 21, 3, 12, 2],
                                ['Project_003', 12, -9, 31, 4, 1, 12],
                                ['Project_004', 8, 1, 4, 7, 9, -5]
                            ]
                        },
                        point: {
                            show: false
                        }
                    })
                } else {
                    $(".compare-list").hide();
                }
            })

            // 그래프 비교 트리
            $(".compare-items li").click(function () {
                $(this).find(".sub-list").slideToggle();
                // $(this).toggleClass("is-unchecked")
                // chart_compare.toggle(name);
            })
            $(".compare-items .view").click(function (e) {
                e.stopPropagation();
                $(this).toggleClass("disabled");
                console.log($(this).hasClass("disabled"));
                
                if ($(this).hasClass("disabled")) {
                    $(this).parent().next().find(".compare-items-2 li").addClass("disabled");
                }else{
                    $(this).parent().next().find(".compare-items-2 li").removeClass("disabled");
                }
            })
            $(".compare-items-2 li").click(function (e) {
                e.stopPropagation();
                $(this).toggleClass("disabled");
            })


            // 로컬스토리지 로드
            var project = JSON.parse(localStorage.project);
            var sub_system = localStorage.sub_system;

            // 정보창 셋팅
            $("[name=title]").text(project.info.title);
            $("[name=type]").text(project.info.type);
            $("[name=frontAxle]").text(project.info.frontAxle);
            $("[name=rearAxle]").text(project.info.rearAxle);
            $("[name=subSystem]").text(sub_system);

            $(".button-save").click(function (e) {
                e.preventDefault();
                $(".modal-save").addClass("is-active");
            })

            $(".modal-background, button.delete, .modal-close, .button-close").click(function (e) {
                e.preventDefault();
                $(this).parents(".modal").removeClass("is-active");
            })

            $(".button-history").click(function (e) {
                e.preventDefault();
                $(".modal-history").addClass("is-active");
            })
        })

        $(window).on('load', function () {

            var keys, values;
            var getUrl = "./data/sampleRes.json";

            function getData() {
                return new Promise(function (resolve, reject) {
                    $.getJSON(getUrl, function (response) {
                        if (response) {
                            resolve(response);
                        }
                        reject(new Error("failed"));
                    })
                })
            }

            getData().then(function (data) {
                    keys = Object.keys(data);
                    values = Object.values(data);
                })
                .then(function () {
                    makeCanvas(keys, values, $("#charts"));
                })

            function makeDataPoints(key, values) {
                var arrayLabel = new Array();
                arrayLabel.push(key);
                for (var i = 0; i < values.length; i++) {
                    arrayLabel.push(values[i]);
                }
                return arrayLabel;
            }

            function makeCanvas(keys, values, container) {
                var target = container;

                for (var i = 0; i < keys.length; i++) {
                    target.append("<div id=chart_" + i + "></div>");
                    var dataPoints = makeDataPoints(keys[i], values[i]);

                    var container = "#chart_" + i;

                    var chart = c3.generate({
                        bindto: container,
                        data: {
                            columns: [dataPoints]
                        },
                        axis: {
                            x: {
                                // show: false
                            }
                        },
                        point: {
                            show: false
                        },
                        color: {
                            pattern: ['#ff3860']
                        },
                        oninit: function () {
                            if (i == keys.length - 1) {
                                $(".is-waiting").hide();
                            }

                        }
                    })
                }

                $("div[id^=chart_]").eq(0).before("<h3>Plot – Parallel Wheel Travel</h3>");
                $("div[id^=chart_]").eq(4).before("<h3>Plot – Longitudinal Wheel Centre Compliance</h3>");
                $("div[id^=chart_]").eq(6).before("<h3>Plot - Longitudinal Toe Compliance</h3>");
                $("div[id^=chart_]").eq(8).before("<h3>Plot - Lateral Wheel Centre Compliance</h3>");
                $("div[id^=chart_]").eq(10).before("<h3>Plot - Lateral Toe Compliance</h3>");
            }
        })
    </script>
</body>

</html>